# Макропроцессор УУМ-32
## Введение 
Макропроцессор - модуль системного ПО, позволяющий расширить возможности языка ассемблера за счет предварительной обработки исходного текста программы.
Важно понимать, что Макропроцессор осуществляет обработку исходного текста. Он "не вникает" в синтаксис и семантику операторов и переменных языка ассемблера, не знает (как правило) имен, употребляемых в программе, а выполняет только текстовые подстановки. В свою очередь, ассемблер обрабатывает исходный текст, не зная, написан тот или иной оператор программистом "своей рукой" или сгенерирован макропроцессором.
Макропроцессор УУМ-32 предназначен для возможности создания программ, использующих макробиблиотеки. Данный макропроцессор позволяет использовать глобальные переменные и вложенные вызовы макросов.
## Структура библиотеки макросов
В начале любого файла библиотеки макросов описываются глобальные переменные (если они используются в макросах). Название глобальной переменной должно быть уникально, то есть оно не должно дублироваться в файле основного макроассемблера, а также в других библиотеках. Более того, обращение к глобальной переменной допустимо из файла основного макроассемблера, если предварительно включена соответствующая библиотека.
Синтаксис объявления глобальных переменных выглядит следующим образом:
```
	VAR			; НАЧАЛО ЗОНЫ ГЛОБАЛЬНЫХ ПЕРЕМЕННЫХ
var1:	RESW	1
var2:	RESW	1
var3:	RESW	1
…
varN:	RESW	1
	VEND			; КОНЕЦ ЗОНЫ ГЛОБАЛЬНЫХ ПЕРЕМЕННЫХ
```
Зона глобальных переменных содержится между ключевыми словами VAR и VEND.


После зоны глобальных переменных следует зона макросов. 
Синтаксис объявления макросов выглядит следующим образом:
```
innerMacros:		MACRO	&param		; НАЧАЛО МАКРОСА
	LD	A, &param
	WD	#0
	MEND					; КОНЕЦ МАКРОСА

outterMacros:	MACRO			; НАЧАЛО МАКРОСА
	LD	X,#48	
	ST	X, $globalVar
	innerCout	$globalVar		; ВЛОЖЕННЫЙ ВЫЗОВ ДРУГОГО МАКРОСА
$globalVar:	 RESW		1
	MEND					; КОНЕЦ МАКРОСА
```
Тело макроса содержится между ключевыми словами MACRO и MEND, а имя макроса представляет собой метку. 
Макрос может принимать параметры, но имя любого параметра должно начинаться с символа ‘&’. Макрос может иметь неограниченное количество параметров, перечисляемых через запятую. 
Также макрос может иметь помимо имени и внутренние метки, но любая метка должна начинаться с символа ‘$’. 
Допускается вызов из макроса другого макроса данной библиотеки, если вызываемый макрос объявлен ранее.
Если в библиотеке присутствую глобальные переменные, то к ним можно обращаться из тела макроса:
```
VAR			; НАЧАЛО ЗОНЫ ГЛОБАЛЬНЫХ ПЕРЕМЕННЫХ
globalVar:	RESW	1
	VEND			; КОНЕЦ ЗОНЫ ГЛОБАЛЬНЫХ ПЕРЕМЕННЫХ

macros:	MACRO				; НАЧАЛО МАКРОСА
	LD	X,#48	
	ST	X, globalVar
	LD	A, globalVar
	MEND					; КОНЕЦ МАКРОСА
```

## Пример программы
Содержимое файла “code.uum32mlb”
```
	VAR
globalVar:	RESW	1
	VEND
innerCout:	MACRO	&param	
	LD	A, &param
	WD	#0
	MEND		
outterCout:	MACRO
	LD	X,#48	
	ST	X, globalVar
	innerCout	globalVar
	MEND
```
Содержимое файла “code.uum32masm”
```
INCLUDE	"code.uum32mlb"	;Подключение макросов
code:	START	0
begin:	CLEAR 	A		;Загрузка в регистр А константы 0
	CLEAR	X		;Загрузка в регистр X константы 0
	outterCout		;Вызов макроса
	outterCout		;Повторный вызов макроса
return:	RET		;Выход из программы
	END
Содержимое файла “code.uum32asm”, сгенерированного макропроцессором.
code:	START	0
begin:	CLEAR 	A	;Загрузка в регистр А константы 0
	CLEAR	X	;Загрузка в регистр X константы 0
;=============MACRO=============OUTTERCOUT=============
	LD	X,#48	
	ST	X, globalVar
;=============MACRO=============INNERCOUT=============
	LD	A, globalVar
	WD	#0
;=============INNERCOUT==========================MEND=============

;=============OUTTERCOUT==========================MEND=============

;=============MACRO=============OUTTERCOUT=============
	LD	X,#48	
	ST	X, globalVar
;=============MACRO=============INNERCOUT=============
	LD	A, globalVar
	WD	#0
;=============INNERCOUT==========================MEND=============

;=============OUTTERCOUT==========================MEND=============

return:	RET
globalVar:	RESW	1
	END
```
*При написании программы стоит учитывать, что макропроцессор чувствителен к регистру (“Line” и “line” не одно и тоже) !!!

